# Charles Mackay Books

Modernized Next.js storefront for Charles E. MacKay's aviation catalogue. The repo now contains only the tooling we actively use (feeds, book data, blog/image maintenance), so everyday workflows stay lean.

## Development

```
npm install
npm run dev
```

Visit http://localhost:3000 and edit files in `src/app/**`. Hot reload is enabled.

## Production Build

```
npm run build
npm run start
```

`npm run build` automatically runs `npm run docs:books` via the `prebuild` hook, guaranteeing that `Bookinfo.txt` always matches `src/data/books.ts` before deployment.

## Maintenance Scripts

| Command | Purpose |
| --- | --- |
| `npm run docs:books` | Regenerates `Bookinfo.txt` from `src/data/books.ts`. Run whenever book metadata changes. |
| `npm run audit:blogs` | Reports missing featured images/approvals for markdown posts. |
| `npm run images:refresh` | Fetches Wikimedia candidates per blog slug (heavy). |
| `npm run validate:images` | Validates licenses/sources/counts in `data/image-approvals.json`. |
| `npm run images:localize` | Downloads approved remote images into `public/blog-images/**` and rewrites manifest paths. |

## Feeds & SEO

- Products XML: `/products.xml`
- Merchant TSV: `/merchant-feed.txt`
- Shopping Actions XML: `/shopping-actions.xml`
- Sitemap: `/sitemap.xml`
- Image sitemap: `/sitemap-images.xml`
- Robots: `/robots.txt`
- Data highlighter config: `/data-highlighter.json`

Structured data lives in `src/app/layout.tsx` (ItemList + merchant data layer) and `src/components/BookCard.tsx` / `EnhancedBookSEO` for book detail pages.

## Book Catalogue Source of Truth

- `src/data/books.ts` — edit titles, prices, metadata, related posts, etc.
- `Bookinfo.txt` — autogenerated reference for operators. Do **not** hand-edit; update the TypeScript data and rerun `npm run docs:books` (or simply rely on `npm run build`).

## Deployment Checklist

1. Push to `main` (Netlify auto-builds).
2. Confirm Netlify build success.
3. Spot-check Google Search Console & Merchant Center diagnostics.
4. Run the CLI maintenance scripts above as needed.

No legacy "optimizer" dashboards remain—everything is handled through the documented commands and standard Next.js tooling. If new automation is required, add it under `scripts/` and document it here.

